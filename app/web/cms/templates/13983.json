{"title":"update-gaji","type":"cms-template","lang":"","status":"SYSTEM","parent_id":"07087","content":{"type":"API","structure":"","server_on_load":"async ({\n  template,\n  params,\n  render,\n  db,\n  req,\n  reply,\n  user,\n  log,\n  ext,\n  isDev,\n}: Server) => {\n  const { detail } = req.body;\n  const update = await db.detail_penggajian.update({\n    data: {\n      keterangan: detail.keterangan,\n      nominal: parseInt(detail.nominal),\n    },\n    where: {\n      id_detail: detail.id_detail,\n    },\n  });\n\n  // Update total gaji\n  const data = await db.detail_penggajian.findMany({\n    where: {\n      id_penggajian: detail.id_penggajian,\n    },\n  });\n\n  let total = 0;\n  for (let i = 0; i < data.length; i++) {\n    if (data[i].jenis == \"pokok\") {\n      total += data[i].nominal;\n    } else if (data[i].jenis == \"bonus\") {\n      total += data[i].nominal;\n    } else if (data[i].jenis == \"potongan\") {\n      total -= data[i].nominal;\n    }\n  }\n\n  // Update total ke db\n  const update_gaji = await db.penggajian.update({\n    data: {\n      nominal: total,\n    },\n    where: {\n      id_penggajian: detail.id_penggajian,\n    },\n  });\n  reply.send({\n    status: update_gaji ? \"success\" : \"error\",\n  })\n}","figma":{}},"slug":"/api/u-gaji","site":"*","id":"13983"}